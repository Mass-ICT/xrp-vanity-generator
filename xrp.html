<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XRP Vanity Address Generator</title>
    <script src="https://unpkg.com/xrpl@2.3.0/build/xrpl-latest-min.js"></script>
    <style>
        body { font-family: -apple-system, system-ui, sans-serif; max-width: 500px; margin: 40px auto; padding: 20px; background: #f0f2f5; }
        .card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { margin-top: 0; color: #1a1a1a; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #e0e0e0; border-radius: 8px; box-sizing: border-box; font-size: 16px; outline: none; }
        input:focus { border-color: #007bff; }
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px; margin-top: 10px; }
        #startBtn { background: #007bff; color: white; }
        #stopBtn { background: #ff4757; color: white; display: none; }
        #status { margin: 15px 0; font-size: 14px; color: #666; text-align: center; min-height: 20px; }
        #results { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #d4edda; word-break: break-all; display: none; }
        .label { font-weight: bold; font-size: 12px; color: #888; text-transform: uppercase; display: block; margin-top: 10px; }
        .value { font-family: monospace; font-size: 14px; color: #2f3542; background: #eee; padding: 4px 8px; border-radius: 4px; display: block; margin-top: 4px; }
    </style>
</head>
<body>

<div class="card">
    <h2>XRP Vanity Gen</h2>
    <p style="font-size: 14px; color: #555;">The address will start with <strong>r</strong> + your prefix.</p>
    
    <input type="text" id="prefix" placeholder="Example: dev" maxlength="6">
    <button id="startBtn">Start Generating</button>
    <button id="stopBtn">Stop Searching</button>

    <div id="status">Ready</div>
    
    <div id="results">
        <span style="color: #2ed573; font-weight: bold;">✔ Match Found!</span>
        <span class="label">Address</span>
        <span id="foundAddr" class="value"></span>
        <span class="label">Secret Key (Seed)</span>
        <span id="foundSecret" class="value"></span>
        <p style="font-size: 11px; color: #ff4757; margin-top: 15px;">⚠️ Never share your Secret Key with anyone.</p>
    </div>
</div>

<script>
    let worker = null;
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const status = document.getElementById('status');
    const resultsDiv = document.getElementById('results');

    // Worker logic using the modern xrpl library
    const workerFunction = function() {
        self.onmessage = function(e) {
            const prefix = e.data.prefix.toLowerCase();
            const libUrl = e.data.libUrl;
            
            try {
                importScripts(libUrl);
            } catch (err) {
                self.postMessage({ type: 'error', message: 'Could not load XRP library. Check internet connection.' });
                return;
            }

            let attempts = 0;
            while (true) {
                attempts++;
                
                // Using modern xrpl.Wallet.generate()
                const wallet = xrpl.Wallet.generate();
                const address = wallet.classicAddress;
                
                if (address.toLowerCase().substring(1).startsWith(prefix)) {
                    self.postMessage({ 
                        type: 'found', 
                        address: address, 
                        seed: wallet.seed, 
                        attempts: attempts 
                    });
                    break;
                }

                if (attempts % 500 === 0) {
                    self.postMessage({ type: 'progress', attempts: attempts });
                }
            }
        };
    };

    startBtn.onclick = function() {
        const prefix = document.getElementById('prefix').value.trim().toLowerCase();
        if (!prefix) return alert("Please enter a prefix");
        
        resultsDiv.style.display = 'none';
        startBtn.style.display = 'none';
        stopBtn.style.display = 'block';
        status.innerText = "Initializing search...";

        const libUrl = 'https://unpkg.com/xrpl@2.3.0/build/xrpl-latest-min.js';
        const blob = new Blob(['(' + workerFunction.toString() + ')()'], { type: 'text/javascript' });
        
        try {
            worker = new Worker(URL.createObjectURL(blob));
            worker.postMessage({ prefix: prefix, libUrl: libUrl });

            worker.onmessage = function(e) {
                if (e.data.type === 'progress') {
                    status.innerText = "Searching... " + e.data.attempts.toLocaleString() + " attempts";
                } else if (e.data.type === 'found') {
                    document.getElementById('foundAddr').innerText = e.data.address;
                    document.getElementById('foundSecret').innerText = e.data.seed;
                    resultsDiv.style.display = 'block';
                    status.innerText = "Found in " + e.data.attempts.toLocaleString() + " attempts!";
                    stopSearch();
                } else if (e.data.type === 'error') {
                    status.innerText = e.data.message;
                    stopSearch();
                }
            };

            worker.onerror = function(err) {
                status.innerText = "Worker Error. If you have 'Tracking Prevention' on, try a different browser.";
                stopSearch();
            };
        } catch (e) {
            status.innerText = "Failed to start: " + e.message;
            stopSearch();
        }
    };

    stopBtn.onclick = stopSearch;

    function stopSearch() {
        if (worker) {
            worker.terminate();
            worker = null;
        }
        startBtn.style.display = 'block';
        stopBtn.style.display = 'none';
    }
</script>

</body>
</html>